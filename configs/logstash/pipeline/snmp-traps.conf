input {
  snmptrap {
    host => "0.0.0.0"
    port => 1062
    community => ["public"]
  }
}

filter {
  # Add host identification for CSR23 (trap source)
  if [host] == "172.20.20.23" {
    mutate { 
      add_field => { 
        "host.name" => "csr23" 
        "host.ip" => "172.20.20.23" 
      }
    }
  }
  
  # Identify trap type by OID
  if [oid] == "1.3.6.1.6.3.1.1.5.3" {
    mutate { 
      add_tag => ["interface_down"] 
      add_field => { "event.action" => "interface-down" }
    }
  } else if [oid] == "1.3.6.1.6.3.1.1.5.4" {
    mutate { 
      add_tag => ["interface_up"] 
      add_field => { "event.action" => "interface-up" }
    }
  }
  
  # Add data stream fields for proper indexing
  mutate {
    add_field => {
      "data_stream.type" => "logs"
      "data_stream.dataset" => "snmp.trap"
      "data_stream.namespace" => "prod"
    }
  }
}

output {
  # Console output for debugging
  stdout { codec => rubydebug }
  
  # Elasticsearch output - works for Serverless, Cloud, and On-Premise
  elasticsearch {
    hosts => ["${ES_ENDPOINT}"]
    api_key => "${ES_API_KEY}"
    data_stream => true
    data_stream_type => "logs"
    data_stream_dataset => "snmp.trap"
    data_stream_namespace => "prod"
  }
}
